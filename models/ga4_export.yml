version: 2

models:
  - name: ga4_export__user_acquisition_first_user_source_medium_report
    description: >
      GA4 report that tracks how new users are acquired based on the first user medium and source, with metrics regarding engagement, users, total revenue and more.
    tests:
      - dbt_utils.unique_combination_of_columns:
          combination_of_columns:
            - unique_key
            - source_relation
    columns:
      - name: unique_key
        description: A unique field for each record generated by a combination of event_date, first_user_medium, first_user_source, and source_relation.
        tests:
          - not_null

      - name: event_date
        description: Date the report was generated.

      - name: source_relation
        description: The source relation for the data.

      - name: engaged_sessions
        description: The number of sessions where is_session_engaged = 1.

      - name: engagement_rate
        description: The ratio of engaged sessions to total sessions, rounded to 2 decimal places.

      - name: event_count
        description: The total number of events recorded.

      - name: first_user_medium
        description: The medium through which the user was first acquired, derived from user_first_event.

      - name: first_user_source
        description: The source through which the user was first acquired, derived from user_first_event.

      - name: key_events
        description: Count of events defined as key events in the key_events variable.

      - name: new_users
        description: The number of users with a first_visit event. first_visit is an automatically collected event in GA4 for understanding and tracking the initial interactions between users and your website. It focuses on counting the number of new users who visit your website for the first time within a specified timeframe. (https://ga4.com/first-visit-event-ga4)

      - name: total_revenue
        description: The sum of ecommerce_purchase_revenue.

      - name: total_users
        description: The total number of distinct user_pseudo_ids.

      - name: user_engagement_duration
        description: Average engagement time in milliseconds per session for where is_session_engaged = 1, rounded to 2 decimal places.

  - name: ga4_export__traffic_acquisition_session_source_medium_report
    description: >
      GA4 report that tracks user sessions, events, and total revenue by session source and medium, with metrics regarding engagement, users, total revenue and more.
    tests:
      - dbt_utils.unique_combination_of_columns:
          combination_of_columns:
            - unique_key
            - source_relation
    columns:
      - name: unique_key
        description: A unique field for each record generated by a combination of event_date, session_medium, session_source, and source_relation.
        tests:
          - not_null

      - name: event_date
        description: Date the report was generated.

      - name: source_relation
        description: The source relation for the data.

      - name: engaged_sessions
        description: The number of distinct session_ids where is_session_engaged = 1.

      - name: total_sessions
        description: The total number of distinct session_ids.

      - name: engagement_rate
        description: The ratio of engaged sessions to total sessions, rounded to 2 decimal places.

      - name: event_count
        description: The total number of events recorded.

      - name: events_per_session
        description: Average number of events per session, rounded to 2 decimal places.

      - name: key_events
        description: Count of events defined as key events in the key_events variable.

      - name: session_medium
        description: The medium through which the session was acquired, derived from source_medium.

      - name: session_source
        description: The source through which the session was acquired, derived from source_source.

      - name: total_revenue
        description: The sum of ecommerce_purchase_revenue.

      - name: total_users
        description: The total number of distinct user_pseudo_ids.

      - name: user_engagement_duration
        description: Average engagement time in milliseconds per session for where is_session_engaged = 1, rounded to 2 decimal places.

  - name: ga4_export__events_report
    description: GA4 report that tracks interactions (events) across the app or website, summarizing event counts, total revenue generated from events, users, and more.
    tests:
      - dbt_utils.unique_combination_of_columns:
          combination_of_columns:
            - unique_key
            - source_relation
    columns:
      - name: unique_key
        description: A unique field for each record generated by a combination of event_date, event_name, and source_relation.
        tests:
          - not_null

      - name: event_date
        description: Date the report was generated.

      - name: event_name
        description: The name of the event recorded.

      - name: source_relation
        description: The source relation for the data.

      - name: event_count
        description: The total number of events recorded.

      - name: event_count_per_user
        description: Average number of events per user, rounded to 2 decimal places.

      - name: total_revenue
        description: The sum of ecommerce_purchase_revenue, defaulting to 0 if null.

      - name: total_users
        description: The total number of distinct user_pseudo_ids.

  - name: ga4_export__conversions_report
    description: >
      GA4 report that tracks conversion events across the app or website, summarizing event counts, total revenue generated from events, users, and more, to uncover insights in conversion behavior.
    tests:
      - dbt_utils.unique_combination_of_columns:
          combination_of_columns:
            - unique_key
            - source_relation
    columns:
      - name: unique_key
        description: A unique field for each record generated by a combination of event_date, event_name, and source_relation.
        tests:
          - not_null

      - name: event_date
        description: Date the report was generated.

      - name: event_name
        description: The name of the conversion event recorded.

      - name: source_relation
        description: The source relation for the data.

      - name: key_events
        description: Count of events defined as key events in the var('key_events') variable.

      - name: total_revenue
        description: The sum of ecommerce_purchase_revenue, defaulting to 0 if null.

      - name: total_users
        description: The total number of distinct user_pseudo_ids.

  - name: ga4_export__sessions_enhanced
    description: >
      Tracks user sessions across the app or website, summarizing session engagement, start and end times, total events, and more to analyze user behavior during sessions.
    tests:
      - dbt_utils.unique_combination_of_columns:
          combination_of_columns:
            - session_id
            - source_relation
    columns:
    - name: session_id
      description: A unique identifier for each session, used as the primary key.
      tests:
        - not_null

    - name: session_start_time
      description: Timestamp indicating when the session started.

    - name: session_end_time
      description: Timestamp indicating when the session ended.

    - name: total_session_engagement_time_sec
      description: The total engagement time during the session, in seconds, calculated as the sum of engagement time across all events.

    - name: total_events
      description: The total number of events recorded during the session.

    - name: is_engaged_session
      description: A boolean indicating whether the session was considered "engaged," where 1 indicates an engaged session and 0 indicates a non-engaged session.

    - name: source_relation
      description: The source relation for the data.
