version: 2

sources: 
  - name: ga4_export
    database: "{% if target.type != 'spark' %}{{ var('ga4_export_database', target.database) }}{% endif %}" # add var config to dbt_project.yml
    schema: "{{ var('ga4_export_schema', 'ga4_export')}}"

    loader: fivetran
    loaded_at_field: _fivetran_synced
      
    freshness:
      warn_after: {count: 72, period: hour}
      error_after: {count: 96, period: hour}

    tables:
      - name: event
        description: >
          Each record represents an event triggered by a user in GA4, containing details such as event name, timestamp, user ID, and associated parameters.
        identifier: "{{ var('ga4_export_event_identifier', 'event') }}"
        columns:
          - name: _fivetran_id
            description: The unique identifier for this event record.
          - name: timestamp
            description: The time when the event was triggered.
          - name: app_info_id
            description: The identifier for the app instance associated with this event.
          - name: _fivetran_synced
            description: Timestamp indicating when this record was last synced from the source.
          - name: name
            description: The name of the event, such as 'user_engagement', 'purchase', or 'session_start'.
          - name: value_in_usd
            description: The monetary value associated with this event, in USD.
          - name: param_engagement_time_msec
            description: The amount of time the user spent engaging, measured in milliseconds.
          - name: traffic_source_medium
            description: The medium through which the user arrived (e.g., organic, paid).
          - name: traffic_source_source
            description: The source of the traffic (e.g., google, facebook).
          - name: user_pseudo_id
            description: The unique pseudo-identifier for the user, which can be used to track anonymous user sessions.
          - name: event_count
            description: The total number of times this event was triggered.
          - name: total_revenue
            description: The total revenue generated by this event.
          - name: total_users
            description: The total number of unique users who triggered this event.
          - name: event_name
            description: The name of the specific event that occurred (e.g., 'purchase', 'user_engagement').
          - name: key_events
            description: The key conversion events filtered in this report (e.g., 'purchase', 'ecommerce_purchase').
          - name: engaged_sessions
            description: Count of sessions where users actively engaged with the app or website.
          - name: new_users
            description: Count of new users based on the event 'first_open'.
          - name: total_revenue
            description: Total revenue generated from this event, computed in USD.
          - name: session_medium
            description: The medium through which the session originated (e.g., organic, paid).
          - name: session_source
            description: The source of the session (e.g., google, facebook).